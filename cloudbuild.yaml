steps:
  #  - name: node:10.8.0
  #    entrypoint: yarn
  #    args: ["install"]
  #  - name: node:10.8.0
  #    entrypoint: yarn
  #    args: ["jest", "-w", "8"]
  #  - name: node:10.8.0
  #    entrypoint: yarn
  #    args: ["lint"]
  - name: "gcr.io/cloud-builders/docker"
    entrypoint: "bash"
    args:
      [
        "-c",
        "docker build -t gcr.io/cds-snc/vac:latest --build-arg AIRTABLE_READ_KEY=$$AIRTABLE_READ_KEY --build-arg GOOGLE_MAPS_KEY=$$GOOGLE_MAPS_KEY --build-arg GITHUB_PUBLIC_ACCESS_TOKEN=$$GITHUB_PUBLIC_ACCESS_TOKEN .",
      ]
    secretEnv:
      ["AIRTABLE_READ_KEY", "GITHUB_PUBLIC_ACCESS_TOKEN", "GOOGLE_MAPS_KEY"]

options:
  machineType: "N1_HIGHCPU_8"

secrets:
  - kmsKeyName: projects/cds-snc/locations/global/keyRings/cds-keys/cryptoKeys/vac
    secretEnv:
      AIRTABLE_READ_KEY: CiQADT94XjGY/uCtWuyuBbqng43qHScW7GqBmJV9UPRKqg7GidwSOgAGcDO4Uis7vXYG6/BeqgcFVC2vHpAGGjb+AkG0hI7UI2P3WbEoFjrKYEYsPfUPY02ZiZqGlNjclII=
      GITHUB_PUBLIC_ACCESS_TOKEN: CiQADT94Xj+8OkeJbDMqvGHSlEvsQjcLDEBIpEgljWeib5hHWAwSQwAGcDO4ACSbnRIiELSoxFOoBkOijue8fvOKrIYpA3A35zydtNKh6yG+s5jazwA5NUIVeX8jzFf6sh6z/ON3SFLtVhM=
      GOOGLE_MAPS_KEY: CiQADT94XvT8/sQechtyROf0ek7wtS7xojpdisa9TujbrmC7QA8SOAAGcDO4sobCtNJh8KKYINpYXr+zrhFEDSsmKVUDbpzrsRhK15j1JbwnR1I4yen1v/U0Ue4NchwY

images: ["gcr.io/cds-snc/vac:latest"]
